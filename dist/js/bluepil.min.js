function drawImageProp(e,a,t,s,n,i,o,r){2===arguments.length&&(t=s=0,n=e.canvas.width,i=e.canvas.height),o="number"==typeof o?o:.5,r="number"==typeof r?r:.5,o<0&&(o=0),r<0&&(r=0),o>1&&(o=1),r>1&&(r=1);var l,d,g,c,m=a.width,u=a.height,h=Math.min(n/m,i/u),f=m*h,p=u*h,v=1;f<n&&(v=n/f),p<i&&(v=i/p),d=(u-(c=u/((p*=v)/i)))*r,(l=(m-(g=m/((f*=v)/n)))*o)<0&&(l=0),d<0&&(d=0),g>m&&(g=m),c>u&&(c=u),e.drawImage(a,l,d,g,c,t,s,n,i)}function _addClass(e,a){e.classList&&e.classList.add?e.classList.add(a):e.className+=" "+a}function _removeClass(e,a){e.classList&&e.classList.remove?e.classList.remove(a):e.className=e.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+"(\\b|$)","gi")," ")}function _hasClass(e,a){return e.classList&&e.classList.contains?e.classList.contains(a):new RegExp("(^| )"+a+"( |$)","gi").test(e.className)}function drawMiniatureForBgImage(e,a,t,s){s="number"==typeof s?s:2;var n=new Image;n.onload=function(){offsets=[],window.getComputedStyle(e,null).backgroundPosition.split(" ").forEach(function(e){offsets.push(parseInt(e)/100)});new CanvasImage(t,n,t.offsetWidth,t.offsetHeight,offsets[0],offsets[1]).blur(s)},n.src=a.src}function loadFullBgImage(e,a,t,s){function n(){e.style.backgroundImage="url("+a.src+")",setTimeout(function(){t.style.opacity=0,"function"==typeof s&&s(!0)},10)}a.src&&a.complete?n():(a.addEventListener("load",n),a.addEventListener("error",function(){"function"==typeof s&&s(!1)}),a.hasAttribute("data-src")&&(a.src=a.dataset.src))}function generateProgressiveBgImgMarkup(e){if(e.dataset.hasOwnProperty("fullImagePath")&&e.dataset.hasOwnProperty("miniaturePath")){e.dataset.hasOwnProperty("scrollLoaded")&&_addClass(e,"scroll-loaded");var a=e.dataset.fullImagePath,t=e.dataset.miniaturePath,s=document.createDocumentFragment(),n=document.createElement("img");n.classList.add("hidden"),n.classList.add("thumbnail"),n.src=t,s.appendChild(n);var i=document.createElement("img");i.classList.add("hidden"),i.classList.add("full-bg-image"),i.setAttribute("data-src",a),s.appendChild(i);var o=document.createElement("canvas");o.classList.add("full-absolute"),o.classList.add("progressive-img-load-canvas"),s.appendChild(o),e.prepend(s),window.getComputedStyle(o).opacity}}function drawMinatureForImage(e,a,t,s,n,i){var o=n/s*100;t.setAttribute("style","padding-bottom:"+o+"%;");var r=e.width,l=e.height;a.height=l,a.width=r,i="number"==typeof i?i:2;var d=new Image;d.onload=function(){new CanvasImage(a,d).blur(i)},d.src=e.src}function loadFullImage(e,a,t){e.onload=function(){e.classList.remove("hidden"),a.style.opacity=0,"function"==typeof t&&t(!0)},e.onerror=function(){"function"==typeof t&&t(!1)},e.src=e.dataset.src}function generateProgressiveImgMarkup(e){if(e.dataset.hasOwnProperty("fullImagePath")&&e.dataset.hasOwnProperty("miniaturePath")&&e.dataset.hasOwnProperty("fullImageWidth")&&e.dataset.hasOwnProperty("fullImageHeight")){var a=e.dataset.fullImagePath,t=e.dataset.miniaturePath,s=e.dataset.fullImageWidth,n=e.dataset.fullImageHeight,i=document.createDocumentFragment(),o=document.createElement("div");o.className=e.className,_addClass(o,"aspectRatioPlaceholder");var r=document.createElement("div");r.classList.add("aspectRatioPlaceholder-fill"),o.appendChild(r);var l=document.createElement("div");_addClass(l,"progressiveMedia"),_addClass(l,"full-absolute"),l.setAttribute("data-width",s),l.setAttribute("data-height",n),e.dataset.hasOwnProperty("scrollLoaded")&&_addClass(l,"scroll-loaded"),o.appendChild(l);var d=document.createElement("img");_addClass(d,"progressiveMedia-thumbnail"),_addClass(d,"hidden"),d.src=t,l.appendChild(d);var g=document.createElement("img");_addClass(g,"progressiveMedia-image"),_addClass(g,"hidden"),_addClass(g,"full-absolute"),g.setAttribute("data-src",a),g.alt=e.alt,l.appendChild(g);var c=document.createElement("canvas");return _addClass(c,"progressiveMedia-canvas"),_addClass(c,"full-absolute"),l.appendChild(c),i.appendChild(o),e.parentNode.insertBefore(i,e.nextSibling),e.remove(),l}}var PIL={};!function(e){"use strict";e.initAllImages=function(){var e=document.getElementsByClassName("progressive-bg-image");this.initBgImages(e);for(var a=Array.prototype.slice.call(document.getElementsByClassName("progressiveMedia")),t=document.getElementsByClassName("progressive-image"),s=0;s<t.length;s++)a.push(generateProgressiveImgMarkup(t[s]));this.initImages(a)},e.loadAllImages=function(){var e=document.getElementsByClassName("progressive-bg-image");this.loadBgImages(e);var a=document.getElementsByClassName("progressiveMedia");this.loadImages(a)},e.loadAllNonScrollLoadedImages=function(){for(var e=document.getElementsByClassName("progressive-bg-image"),a=0;a<e.length;a++)_hasClass(e[a],"scroll-loaded")||this.loadBgImage(e[a]);var t=document.getElementsByClassName("progressiveMedia");for(a=0;a<t.length;a++)_hasClass(t[a],"scroll-loaded")||this.loadImage(t[a])},e.loadImagesSequentially=function(){function e(){t>=a.length||(_hasClass(a[t],"progressive-bg-image")&&s.loadBgImage(a[t],function(){t+=1,e()}),_hasClass(a[t],"progressiveMedia")&&s.loadImage(a[t],function(){t+=1,e()}))}var a=document.querySelectorAll(".progressive-bg-image, .progressiveMedia"),t=0,s=this;e()},e.initScrollLoadedImages=function(){function e(){for(var e=document.getElementsByClassName("scroll-loaded"),a=window.innerHeight,t=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,s=t+a,n=0;n<e.length;n++){var i=e[n].getBoundingClientRect(),o=t+i.top;o+i.height>t&&o<s&&(_hasClass(e[n],"progressive-bg-image")&&PIL.loadBgImage(e[n]),_hasClass(e[n],"progressiveMedia")&&PIL.loadImage(e[n]),_removeClass(e[n],"scroll-loaded"))}}document.addEventListener("scroll",e),document.addEventListener("resize",e),e()},e.fullImageLoaded=function(e){},e.go=function(){function e(){a.initAllImages(),a.loadAllImages()}var a=this;document.readyState,e()}}(PIL),CanvasImage=function(e,a,t,s,n,i){this.image=a,this.element=e,e.width="number"==typeof t?t:a.width,e.height="number"==typeof s?s:a.height,n="number"==typeof n?n:.5,i="number"==typeof i?i:.5,this.context=e.getContext("2d"),drawImageProp(this.context,a,0,0,e.width,e.height,n,i)},CanvasImage.prototype={blur:function(e){this.context.globalAlpha=.5;for(var a=-e;a<=e;a+=2)for(var t=-e;t<=e;t+=2){this.context.drawImage(this.element,t,a);t>=0&&a>=0&&this.context.drawImage(this.element,-(t-1),-(a-1))}}},function(e){"use strict";e.initBgImage=function(e){generateProgressiveBgImgMarkup(e);drawMiniatureForBgImage(e,e.querySelector(".thumbnail"),e.querySelector(".progressive-img-load-canvas"))},e.initBgImages=function(e){for(var a=0;a<e.length;a++)this.initBgImage(e[a])},e.loadBgImage=function(e,a){var t=e.querySelector(".full-bg-image"),s=e.querySelector(".progressive-img-load-canvas"),n=this;loadFullBgImage(e,t,s,function(t){n.fullImageLoaded({root_el:e,canvas:s}),"function"==typeof a&&a(t)})},e.loadBgImages=function(e){for(var a=0;a<e.length;a++)this.loadBgImage(e[a])}}(PIL),function(e){"use strict";e.initImage=function(e){drawMinatureForImage(e.querySelector(".progressiveMedia-thumbnail"),e.querySelector(".progressiveMedia-canvas"),e.previousElementSibling,e.dataset.width,e.dataset.height)},e.initImages=function(e){for(var a=0;a<e.length;a++)this.initImage(e[a])},e.loadImage=function(e,a){var t=e.querySelector(".progressiveMedia-image"),s=e.querySelector(".progressiveMedia-canvas"),n=this;loadFullImage(t,s,function(t){n.fullImageLoaded({root_el:e,canvas:s}),"function"==typeof a&&a(t)})},e.loadImages=function(e){for(var a=0;a<e.length;a++)this.loadImage(e[a])}}(PIL);