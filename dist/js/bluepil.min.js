function drawImageProp(e,a,t,s,o,n,l,r){2===arguments.length&&(t=s=0,o=e.canvas.width,n=e.canvas.height),l="number"==typeof l?l:.5,r="number"==typeof r?r:.5,l<0&&(l=0),r<0&&(r=0),l>1&&(l=1),r>1&&(r=1);var i,d,g,c,m=a.width,u=a.height,h=Math.min(o/m,n/u),f=m*h,p=u*h,v=1;f<o&&(v=o/f),p<n&&(v=n/p),d=(u-(c=u/((p*=v)/n)))*r,(i=(m-(g=m/((f*=v)/o)))*l)<0&&(i=0),d<0&&(d=0),g>m&&(g=m),c>u&&(c=u),e.drawImage(a,i,d,g,c,t,s,o,n)}function _addClass(e,a){e.classList&&e.classList.add?e.classList.add(a):e.className+=" "+a}function _removeClass(e,a){e.classList&&e.classList.remove?e.classList.remove(a):e.className=e.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+"(\\b|$)","gi")," ")}function _hasClass(e,a){return e.classList&&e.classList.contains?e.classList.contains(a):new RegExp("(^| )"+a+"( |$)","gi").test(e.className)}function drawMiniatureForBgImage(e,a,t,s){s="number"==typeof s?s:2;var o=new Image;o.onload=function(){offsets=[],window.getComputedStyle(e,null).backgroundPosition.split(" ").forEach(function(e){offsets.push(parseInt(e)/100)});new CanvasImage(t,o,t.offsetWidth,t.offsetHeight,offsets[0],offsets[1]).blur(s)},o.src=a.src}function loadFullBgImage(e,a,t,s){function o(){e.style.backgroundImage="url("+a.src+")",setTimeout(function(){_addClass(e,"full-loaded"),"function"==typeof s&&s(!0)},10)}a.src&&a.complete?o():(a.addEventListener("load",o),a.addEventListener("error",function(){"function"==typeof s&&s(!1)}),a.hasAttribute("data-src")&&(a.src=a.dataset.src))}function generateProgressiveBgImgMarkup(e){if(e.dataset.hasOwnProperty("fullImagePath")&&e.dataset.hasOwnProperty("miniaturePath")){e.dataset.hasOwnProperty("scrollLoaded")&&_addClass(e,"scroll-loaded");var a=e.dataset.fullImagePath,t=e.dataset.miniaturePath,s=document.createDocumentFragment(),o=document.createElement("img");_addClass(o,"hidden"),_addClass(o,"thumbnail"),o.src=t,s.appendChild(o);var n=document.createElement("img");_addClass(n,"hidden"),_addClass(n,"full-bg-image"),n.setAttribute("data-src",a),s.appendChild(n);var l=document.createElement("canvas");_addClass(l,"full-absolute"),_addClass(l,"progressive-img-load-canvas"),s.appendChild(l),e.prepend(s),window.getComputedStyle(l).opacity}}function drawMinatureForImage(e,a,t,s,o,n){var l=o/s*100;t.setAttribute("style","padding-bottom:"+l+"%;");var r=e.width,i=e.height;a.height=i,a.width=r,n="number"==typeof n?n:2;var d=new Image;d.onload=function(){new CanvasImage(a,d).blur(n)},d.src=e.src}function loadFullImage(e,a,t,s){a.onload=function(){_removeClass(a,"hidden"),_addClass(e,"full-loaded"),"function"==typeof s&&s(!0)},a.onerror=function(){"function"==typeof s&&s(!1)},a.src=a.dataset.src}function generateProgressiveImgMarkup(e){if(e.dataset.hasOwnProperty("fullImagePath")&&e.dataset.hasOwnProperty("miniaturePath")&&e.dataset.hasOwnProperty("fullImageWidth")&&e.dataset.hasOwnProperty("fullImageHeight")){var a=e.dataset.fullImagePath,t=e.dataset.miniaturePath,s=e.dataset.fullImageWidth,o=e.dataset.fullImageHeight,n=document.createDocumentFragment(),l=document.createElement("div");l.className=e.className,_addClass(l,"aspectRatioPlaceholder");var r=document.createElement("div");_addClass(r,"aspectRatioPlaceholder-fill"),l.appendChild(r);var i=document.createElement("div");_addClass(i,"progressiveMedia"),_addClass(i,"full-absolute"),i.setAttribute("data-width",s),i.setAttribute("data-height",o),e.dataset.hasOwnProperty("scrollLoaded")&&_addClass(i,"scroll-loaded"),l.appendChild(i);var d=document.createElement("img");_addClass(d,"progressiveMedia-thumbnail"),_addClass(d,"hidden"),d.src=t,i.appendChild(d);var g=document.createElement("img");_addClass(g,"progressiveMedia-image"),_addClass(g,"hidden"),_addClass(g,"full-absolute"),g.setAttribute("data-src",a),g.alt=e.alt,i.appendChild(g);var c=document.createElement("canvas");return _addClass(c,"progressiveMedia-canvas"),_addClass(c,"full-absolute"),i.appendChild(c),n.appendChild(l),e.parentNode.insertBefore(n,e.nextSibling),e.remove(),i}}var PIL={};!function(e){"use strict";e.initAllImages=function(){var e=document.getElementsByClassName("progressive-bg-image");this.initBgImages(e);for(var a=Array.prototype.slice.call(document.getElementsByClassName("progressiveMedia")),t=document.getElementsByClassName("progressive-image"),s=0;s<t.length;s++)a.push(generateProgressiveImgMarkup(t[s]));this.initImages(a)},e.loadAllImages=function(){var e=document.getElementsByClassName("progressive-bg-image");this.loadBgImages(e);var a=document.getElementsByClassName("progressiveMedia");this.loadImages(a)},e.loadAllNonScrollLoadedImages=function(){for(var e=document.getElementsByClassName("progressive-bg-image"),a=0;a<e.length;a++)_hasClass(e[a],"scroll-loaded")||this.loadBgImage(e[a]);var t=document.getElementsByClassName("progressiveMedia");for(a=0;a<t.length;a++)_hasClass(t[a],"scroll-loaded")||this.loadImage(t[a])},e.loadImagesSequentially=function(){function e(){t>=a.length||(_hasClass(a[t],"progressive-bg-image")&&s.loadBgImage(a[t],function(){t+=1,e()}),_hasClass(a[t],"progressiveMedia")&&s.loadImage(a[t],function(){t+=1,e()}))}var a=document.querySelectorAll(".progressive-bg-image, .progressiveMedia"),t=0,s=this;e()},e.initScrollLoadedImages=function(){function e(){for(var e=document.getElementsByClassName("scroll-loaded"),a=window.innerHeight,t=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,s=t+a,o=0;o<e.length;o++){var n=e[o].getBoundingClientRect(),l=t+n.top;l+n.height>t&&l<s&&(_hasClass(e[o],"progressive-bg-image")&&PIL.loadBgImage(e[o]),_hasClass(e[o],"progressiveMedia")&&PIL.loadImage(e[o]),_removeClass(e[o],"scroll-loaded"))}}document.addEventListener("scroll",e),document.addEventListener("resize",e),e()},e.fullImageLoaded=function(e){},e.go=function(){function e(){a.initAllImages(),a.loadAllImages()}var a=this;document.readyState,e()}}(PIL),CanvasImage=function(e,a,t,s,o,n){this.image=a,this.element=e,e.width="number"==typeof t?t:a.width,e.height="number"==typeof s?s:a.height,o="number"==typeof o?o:.5,n="number"==typeof n?n:.5,this.context=e.getContext("2d"),drawImageProp(this.context,a,0,0,e.width,e.height,o,n)},CanvasImage.prototype={blur:function(e){this.context.globalAlpha=.5;for(var a=-e;a<=e;a+=2)for(var t=-e;t<=e;t+=2){this.context.drawImage(this.element,t,a);t>=0&&a>=0&&this.context.drawImage(this.element,-(t-1),-(a-1))}}},function(e){"use strict";e.initBgImage=function(e){generateProgressiveBgImgMarkup(e);drawMiniatureForBgImage(e,e.querySelector(".thumbnail"),e.querySelector(".progressive-img-load-canvas"))},e.initBgImages=function(e){for(var a=0;a<e.length;a++)try{this.initBgImage(e[a])}catch(t){console.error(t),console.log("BluePil error: the following element failed to init: "),console.log(e[a])}},e.loadBgImage=function(e,a){var t=e.querySelector(".full-bg-image"),s=e.querySelector(".progressive-img-load-canvas"),o=this;loadFullBgImage(e,t,s,function(t){o.fullImageLoaded({root_el:e,canvas:s}),"function"==typeof a&&a(t)})},e.loadBgImages=function(e){for(var a=0;a<e.length;a++)try{this.loadBgImage(e[a])}catch(t){console.error(t),console.log("BluePil error: the following element failed to load: "),console.log(e[a])}}}(PIL),function(e){"use strict";e.initImage=function(e){drawMinatureForImage(e.querySelector(".progressiveMedia-thumbnail"),e.querySelector(".progressiveMedia-canvas"),e.previousElementSibling,e.dataset.width,e.dataset.height)},e.initImages=function(e){for(var a=0;a<e.length;a++)try{this.initImage(e[a])}catch(t){console.error(t),console.log("BluePil error: the following element failed to init: "),console.log(e[a])}},e.loadImage=function(e,a){var t=e.querySelector(".progressiveMedia-image"),s=e.querySelector(".progressiveMedia-canvas"),o=this;loadFullImage(e,t,s,function(t){o.fullImageLoaded({root_el:e,canvas:s}),"function"==typeof a&&a(t)})},e.loadImages=function(e){for(var a=0;a<e.length;a++)try{this.loadImage(e[a])}catch(t){console.error(t),console.log("BluePil error: the following element failed to load: "),console.log(e[a])}}}(PIL);