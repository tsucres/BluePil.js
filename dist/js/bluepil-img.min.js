function drawImageProp(e,a,t,s,n,i,o,l){2===arguments.length&&(t=s=0,n=e.canvas.width,i=e.canvas.height),o="number"==typeof o?o:.5,l="number"==typeof l?l:.5,o<0&&(o=0),l<0&&(l=0),o>1&&(o=1),l>1&&(l=1);var d,r,c,m,g=a.width,u=a.height,h=Math.min(n/g,i/u),f=g*h,p=u*h,v=1;f<n&&(v=n/f),p<i&&(v=i/p),r=(u-(m=u/((p*=v)/i)))*l,(d=(g-(c=g/((f*=v)/n)))*o)<0&&(d=0),r<0&&(r=0),c>g&&(c=g),m>u&&(m=u),e.drawImage(a,d,r,c,m,t,s,n,i)}function _addClass(e,a){e.classList&&e.classList.add?e.classList.add(a):e.className+=" "+a}function _removeClass(e,a){e.classList&&e.classList.remove?e.classList.remove(a):e.className=e.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+"(\\b|$)","gi")," ")}function _hasClass(e,a){return e.classList&&e.classList.contains?e.classList.contains(a):new RegExp("(^| )"+a+"( |$)","gi").test(e.className)}function drawMinatureForImage(e,a,t,s,n,i){var o=n/s*100;t.setAttribute("style","padding-bottom:"+o+"%;");var l=e.width,d=e.height;a.height=d,a.width=l,i="number"==typeof i?i:2;var r=new Image;r.onload=function(){new CanvasImage(a,r).blur(i)},r.src=e.src}function loadFullImage(e,a,t,s){a.onload=function(){_removeClass(a,"hidden"),_addClass(e,"full-loaded"),"function"==typeof s&&s(!0)},a.onerror=function(){"function"==typeof s&&s(!1)},a.src=a.dataset.src}function generateProgressiveImgMarkup(e){if(e.dataset.hasOwnProperty("fullImagePath")&&e.dataset.hasOwnProperty("miniaturePath")&&e.dataset.hasOwnProperty("fullImageWidth")&&e.dataset.hasOwnProperty("fullImageHeight")){var a=e.dataset.fullImagePath,t=e.dataset.miniaturePath,s=e.dataset.fullImageWidth,n=e.dataset.fullImageHeight,i=document.createDocumentFragment(),o=document.createElement("div");o.className=e.className,_addClass(o,"aspectRatioPlaceholder");var l=document.createElement("div");_addClass(l,"aspectRatioPlaceholder-fill"),o.appendChild(l);var d=document.createElement("div");_addClass(d,"progressiveMedia"),_addClass(d,"full-absolute"),d.setAttribute("data-width",s),d.setAttribute("data-height",n),e.dataset.hasOwnProperty("scrollLoaded")&&_addClass(d,"scroll-loaded"),o.appendChild(d);var r=document.createElement("img");_addClass(r,"progressiveMedia-thumbnail"),_addClass(r,"hidden"),r.src=t,d.appendChild(r);var c=document.createElement("img");_addClass(c,"progressiveMedia-image"),_addClass(c,"hidden"),_addClass(c,"full-absolute"),c.setAttribute("data-src",a),c.alt=e.alt,d.appendChild(c);var m=document.createElement("canvas");return _addClass(m,"progressiveMedia-canvas"),_addClass(m,"full-absolute"),d.appendChild(m),i.appendChild(o),e.parentNode.insertBefore(i,e.nextSibling),e.remove(),d}}var PIL={};!function(e){"use strict";e.initAllImages=function(){for(var e=Array.prototype.slice.call(document.getElementsByClassName("progressiveMedia")),a=document.getElementsByClassName("progressive-image"),t=0;t<a.length;t++)e.push(generateProgressiveImgMarkup(a[t]));this.initImages(e)},e.loadAllImages=function(){var e=document.getElementsByClassName("progressiveMedia");this.loadImages(e)},e.loadAllNonScrollLoadedImages=function(){for(var e=document.getElementsByClassName("progressiveMedia"),a=0;a<e.length;a++)_hasClass(e[a],"scroll-loaded")||this.loadImage(e[a])},e.loadImagesSequentially=function(){function e(){t>=a.length||_hasClass(a[t],"progressiveMedia")&&s.loadImage(a[t],function(){t+=1,e()})}var a=document.querySelectorAll(".progressive-bg-image, .progressiveMedia"),t=0,s=this;e()},e.initScrollLoadedImages=function(){function e(){for(var e=document.getElementsByClassName("scroll-loaded"),a=window.innerHeight,t=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,s=t+a,n=0;n<e.length;n++){var i=e[n].getBoundingClientRect(),o=t+i.top;o+i.height>t&&o<s&&(_hasClass(e[n],"progressiveMedia")&&PIL.loadImage(e[n]),_removeClass(e[n],"scroll-loaded"))}}document.addEventListener("scroll",e),document.addEventListener("resize",e),e()},e.fullImageLoaded=function(e){},e.go=function(){function e(){a.initAllImages(),a.loadAllImages()}var a=this;document.readyState,e()}}(PIL),CanvasImage=function(e,a,t,s,n,i){this.image=a,this.element=e,e.width="number"==typeof t?t:a.width,e.height="number"==typeof s?s:a.height,n="number"==typeof n?n:.5,i="number"==typeof i?i:.5,this.context=e.getContext("2d"),drawImageProp(this.context,a,0,0,e.width,e.height,n,i)},CanvasImage.prototype={blur:function(e){this.context.globalAlpha=.5;for(var a=-e;a<=e;a+=2)for(var t=-e;t<=e;t+=2){this.context.drawImage(this.element,t,a);t>=0&&a>=0&&this.context.drawImage(this.element,-(t-1),-(a-1))}}},function(e){"use strict";e.initImage=function(e){drawMinatureForImage(e.querySelector(".progressiveMedia-thumbnail"),e.querySelector(".progressiveMedia-canvas"),e.previousElementSibling,e.dataset.width,e.dataset.height)},e.initImages=function(e){for(var a=0;a<e.length;a++)this.initImage(e[a])},e.loadImage=function(e,a){var t=e.querySelector(".progressiveMedia-image"),s=e.querySelector(".progressiveMedia-canvas"),n=this;loadFullImage(e,t,s,function(t){n.fullImageLoaded({root_el:e,canvas:s}),"function"==typeof a&&a(t)})},e.loadImages=function(e){for(var a=0;a<e.length;a++)this.loadImage(e[a])}}(PIL);