function drawImageProp(e,a,t,s,o,n,l,i){2===arguments.length&&(t=s=0,o=e.canvas.width,n=e.canvas.height),l="number"==typeof l?l:.5,i="number"==typeof i?i:.5,l<0&&(l=0),i<0&&(i=0),l>1&&(l=1),i>1&&(i=1);var r,d,c,m,g=a.width,u=a.height,h=Math.min(o/g,n/u),f=g*h,p=u*h,v=1;f<o&&(v=o/f),p<n&&(v=n/p),d=(u-(m=u/((p*=v)/n)))*i,(r=(g-(c=g/((f*=v)/o)))*l)<0&&(r=0),d<0&&(d=0),c>g&&(c=g),m>u&&(m=u),e.drawImage(a,r,d,c,m,t,s,o,n)}function _addClass(e,a){e.classList&&e.classList.add?e.classList.add(a):e.className+=" "+a}function _removeClass(e,a){e.classList&&e.classList.remove?e.classList.remove(a):e.className=e.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+"(\\b|$)","gi")," ")}function _hasClass(e,a){return e.classList&&e.classList.contains?e.classList.contains(a):new RegExp("(^| )"+a+"( |$)","gi").test(e.className)}function drawMinatureForImage(e,a,t,s,o,n){var l=o/s*100;t.setAttribute("style","padding-bottom:"+l+"%;");var i=e.width,r=e.height;a.height=r,a.width=i,n="number"==typeof n?n:2;var d=new Image;d.onload=function(){new CanvasImage(a,d).blur(n)},d.src=e.src}function loadFullImage(e,a,t,s){a.onload=function(){_removeClass(a,"hidden"),_addClass(e,"full-loaded"),"function"==typeof s&&s(!0)},a.onerror=function(){"function"==typeof s&&s(!1)},a.src=a.dataset.src}function generateProgressiveImgMarkup(e){if(e.dataset.hasOwnProperty("fullImagePath")&&e.dataset.hasOwnProperty("miniaturePath")&&e.dataset.hasOwnProperty("fullImageWidth")&&e.dataset.hasOwnProperty("fullImageHeight")){var a=e.dataset.fullImagePath,t=e.dataset.miniaturePath,s=e.dataset.fullImageWidth,o=e.dataset.fullImageHeight,n=document.createDocumentFragment(),l=document.createElement("div");l.className=e.className,_addClass(l,"aspectRatioPlaceholder");var i=document.createElement("div");_addClass(i,"aspectRatioPlaceholder-fill"),l.appendChild(i);var r=document.createElement("div");_addClass(r,"progressiveMedia"),_addClass(r,"full-absolute"),r.setAttribute("data-width",s),r.setAttribute("data-height",o),e.dataset.hasOwnProperty("scrollLoaded")&&_addClass(r,"scroll-loaded"),l.appendChild(r);var d=document.createElement("img");_addClass(d,"progressiveMedia-thumbnail"),_addClass(d,"hidden"),d.src=t,r.appendChild(d);var c=document.createElement("img");_addClass(c,"progressiveMedia-image"),_addClass(c,"hidden"),_addClass(c,"full-absolute"),c.setAttribute("data-src",a),c.alt=e.alt,r.appendChild(c);var m=document.createElement("canvas");return _addClass(m,"progressiveMedia-canvas"),_addClass(m,"full-absolute"),r.appendChild(m),n.appendChild(l),e.parentNode.insertBefore(n,e.nextSibling),e.remove(),r}}var PIL={};!function(e){"use strict";e.initAllImages=function(){for(var e=Array.prototype.slice.call(document.getElementsByClassName("progressiveMedia")),a=document.getElementsByClassName("progressive-image"),t=0;t<a.length;t++)e.push(generateProgressiveImgMarkup(a[t]));this.initImages(e)},e.loadAllImages=function(){var e=document.getElementsByClassName("progressiveMedia");this.loadImages(e)},e.loadAllNonScrollLoadedImages=function(){for(var e=document.getElementsByClassName("progressiveMedia"),a=0;a<e.length;a++)_hasClass(e[a],"scroll-loaded")||this.loadImage(e[a])},e.loadImagesSequentially=function(){function e(){t>=a.length||_hasClass(a[t],"progressiveMedia")&&s.loadImage(a[t],function(){t+=1,e()})}var a=document.querySelectorAll(".progressive-bg-image, .progressiveMedia"),t=0,s=this;e()},e.initScrollLoadedImages=function(){function e(){for(var e=document.getElementsByClassName("scroll-loaded"),a=window.innerHeight,t=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,s=t+a,o=0;o<e.length;o++){var n=e[o].getBoundingClientRect(),l=t+n.top;l+n.height>t&&l<s&&(_hasClass(e[o],"progressiveMedia")&&PIL.loadImage(e[o]),_removeClass(e[o],"scroll-loaded"))}}document.addEventListener("scroll",e),document.addEventListener("resize",e),e()},e.fullImageLoaded=function(e){},e.go=function(){function e(){a.initAllImages(),a.loadAllImages()}var a=this;document.readyState,e()}}(PIL),CanvasImage=function(e,a,t,s,o,n){this.image=a,this.element=e,e.width="number"==typeof t?t:a.width,e.height="number"==typeof s?s:a.height,o="number"==typeof o?o:.5,n="number"==typeof n?n:.5,this.context=e.getContext("2d"),drawImageProp(this.context,a,0,0,e.width,e.height,o,n)},CanvasImage.prototype={blur:function(e){this.context.globalAlpha=.5;for(var a=-e;a<=e;a+=2)for(var t=-e;t<=e;t+=2){this.context.drawImage(this.element,t,a);t>=0&&a>=0&&this.context.drawImage(this.element,-(t-1),-(a-1))}}},function(e){"use strict";e.initImage=function(e){drawMinatureForImage(e.querySelector(".progressiveMedia-thumbnail"),e.querySelector(".progressiveMedia-canvas"),e.previousElementSibling,e.dataset.width,e.dataset.height)},e.initImages=function(e){for(var a=0;a<e.length;a++)try{this.initImage(e[a])}catch(t){console.error(t),console.log("BluePil error: the following element failed to init: "),console.log(e[a])}},e.loadImage=function(e,a){var t=e.querySelector(".progressiveMedia-image"),s=e.querySelector(".progressiveMedia-canvas"),o=this;loadFullImage(e,t,s,function(t){o.fullImageLoaded({root_el:e,canvas:s}),"function"==typeof a&&a(t)})},e.loadImages=function(e){for(var a=0;a<e.length;a++)try{this.loadImage(e[a])}catch(t){console.error(t),console.log("BluePil error: the following element failed to load: "),console.log(e[a])}}}(PIL);