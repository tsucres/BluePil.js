function drawImageProp(e,t,a,s,n,o,i,l){2===arguments.length&&(a=s=0,n=e.canvas.width,o=e.canvas.height),i="number"==typeof i?i:.5,l="number"==typeof l?l:.5,i<0&&(i=0),l<0&&(l=0),i>1&&(i=1),l>1&&(l=1);var r,d,g,c,m=t.width,u=t.height,f=Math.min(n/m,o/u),h=m*f,p=u*f,v=1;h<n&&(v=n/h),p<o&&(v=o/p),d=(u-(c=u/((p*=v)/o)))*l,(r=(m-(g=m/((h*=v)/n)))*i)<0&&(r=0),d<0&&(d=0),g>m&&(g=m),c>u&&(c=u),e.drawImage(t,r,d,g,c,a,s,n,o)}function _addClass(e,t){e.classList&&e.classList.add?e.classList.add(t):e.className+=" "+t}function _removeClass(e,t){e.classList&&e.classList.remove?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")}function _hasClass(e,t){return e.classList&&e.classList.contains?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)}function drawMiniatureForBgImage(e,t,a,s){s="number"==typeof s?s:2;var n=new Image;n.onload=function(){offsets=[],window.getComputedStyle(e,null).backgroundPosition.split(" ").forEach(function(e){offsets.push(parseInt(e)/100)});new CanvasImage(a,n,a.offsetWidth,a.offsetHeight,offsets[0],offsets[1]).blur(s)},n.src=t.src}function loadFullBgImage(e,t,a,s){function n(){e.style.backgroundImage="url("+t.src+")",setTimeout(function(){_addClass(e,"full-loaded"),"function"==typeof s&&s(!0)},10)}t.src&&t.complete?n():(t.addEventListener("load",n),t.addEventListener("error",function(){"function"==typeof s&&s(!1)}),t.hasAttribute("data-src")&&(t.src=t.dataset.src))}function generateProgressiveBgImgMarkup(e){if(e.dataset.hasOwnProperty("fullImagePath")&&e.dataset.hasOwnProperty("miniaturePath")){e.dataset.hasOwnProperty("scrollLoaded")&&_addClass(e,"scroll-loaded");var t=e.dataset.fullImagePath,a=e.dataset.miniaturePath,s=document.createDocumentFragment(),n=document.createElement("img");_addClass(n,"hidden"),_addClass(n,"thumbnail"),n.src=a,s.appendChild(n);var o=document.createElement("img");_addClass(o,"hidden"),_addClass(o,"full-bg-image"),o.setAttribute("data-src",t),s.appendChild(o);var i=document.createElement("canvas");_addClass(i,"full-absolute"),_addClass(i,"progressive-img-load-canvas"),s.appendChild(i),e.prepend(s),window.getComputedStyle(i).opacity}}var PIL={};!function(e){"use strict";e.initAllImages=function(){var e=document.getElementsByClassName("progressive-bg-image");this.initBgImages(e)},e.loadAllImages=function(){var e=document.getElementsByClassName("progressive-bg-image");this.loadBgImages(e)},e.loadAllNonScrollLoadedImages=function(){for(var e=document.getElementsByClassName("progressive-bg-image"),t=0;t<e.length;t++)_hasClass(e[t],"scroll-loaded")||this.loadBgImage(e[t])},e.loadImagesSequentially=function(){function e(){a>=t.length||_hasClass(t[a],"progressive-bg-image")&&s.loadBgImage(t[a],function(){a+=1,e()})}var t=document.querySelectorAll(".progressive-bg-image, .progressiveMedia"),a=0,s=this;e()},e.initScrollLoadedImages=function(){function e(){for(var e=document.getElementsByClassName("scroll-loaded"),t=window.innerHeight,a=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,s=a+t,n=0;n<e.length;n++){var o=e[n].getBoundingClientRect(),i=a+o.top;i+o.height>a&&i<s&&(_hasClass(e[n],"progressive-bg-image")&&PIL.loadBgImage(e[n]),_removeClass(e[n],"scroll-loaded"))}}document.addEventListener("scroll",e),document.addEventListener("resize",e),e()},e.fullImageLoaded=function(e){},e.go=function(){function e(){t.initAllImages(),t.loadAllImages()}var t=this;document.readyState,e()}}(PIL),CanvasImage=function(e,t,a,s,n,o){this.image=t,this.element=e,e.width="number"==typeof a?a:t.width,e.height="number"==typeof s?s:t.height,n="number"==typeof n?n:.5,o="number"==typeof o?o:.5,this.context=e.getContext("2d"),drawImageProp(this.context,t,0,0,e.width,e.height,n,o)},CanvasImage.prototype={blur:function(e){this.context.globalAlpha=.5;for(var t=-e;t<=e;t+=2)for(var a=-e;a<=e;a+=2){this.context.drawImage(this.element,a,t);a>=0&&t>=0&&this.context.drawImage(this.element,-(a-1),-(t-1))}}},function(e){"use strict";e.initBgImage=function(e){generateProgressiveBgImgMarkup(e);drawMiniatureForBgImage(e,e.querySelector(".thumbnail"),e.querySelector(".progressive-img-load-canvas"))},e.initBgImages=function(e){for(var t=0;t<e.length;t++)try{this.initBgImage(e[t])}catch(e){}},e.loadBgImage=function(e,t){var a=e.querySelector(".full-bg-image"),s=e.querySelector(".progressive-img-load-canvas"),n=this;loadFullBgImage(e,a,s,function(a){n.fullImageLoaded({root_el:e,canvas:s}),"function"==typeof t&&t(a)})},e.loadBgImages=function(e){for(var t=0;t<e.length;t++)try{this.loadBgImage(e[t])}catch(e){}}}(PIL);